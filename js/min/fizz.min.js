/*! Fizz - v0.0.2 | (c) 2014 Michael Zalla |  License */
/*! Read the full source at https://github.com/MichaelZalla/Fizz */
this.Fizz=this.Fizz||{},function(){Fizz.noop=function(){},Object.defineProperty(Object.prototype,"exposeProperty",{value:function(a,b,c){"undefined"==typeof b&&(b="_"+a),"string"==typeof b&&(b=new Function("return this."+b)),"function"!=typeof c&&(c=Fizz.noop),Object.defineProperty(this,a,{get:b,set:c,configurable:!0,enumerable:!1})},writable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(Object.prototype,"banishProperty",{value:function(a,b){b="undefined"==typeof b?!0:b,Object.defineProperty(this,a,{get:Fizz.noop,set:Fizz.noop,configurable:!1,enumerable:!1}),b&&"undefined"!=typeof this["_"+a]&&this.banishProperty("_"+a,!1)},writeable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(Object.prototype,"assign",{value:function(a){if(null===a||"object"!=typeof a)return this;for(var b in a)a.hasOwnProperty(b)&&void 0!==a[b]&&(this[b]=a[b]);return this},writeable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(Object.prototype,"extend",{value:function(a){function b(){if(!(this instanceof b))throw new Error("Constructor called without the 'new' keyword.");"init"in this&&this.init.apply(this,arguments)}b.prototype=Object.create(this.prototype),b.prototype.constructor=b;for(var c in a)a.hasOwnProperty(c)&&(b.prototype[c]=a[c]);return b},writeable:!1,configurable:!1,enumerable:!1}),"function"!=typeof Object.prototype.keys&&Object.defineProperty(Object.prototype,"keys",{value:function(){if(this instanceof Array)return Array.prototype.keys.call(this);var a=[];for(var b in this)this.hasOwnProperty(b)&&a.push(b);return a},writeable:!1,configurable:!1,enumerable:!1}),Object.defineProperty(Object.prototype,"forEach",{value:function(a,b){"undefined"==typeof b&&(b=this);var c=0;for(var d in this)this.hasOwnProperty(d)&&(a.call(b,this[d],d,c),c++)},writeable:!1,configurable:!1,enumerable:!1}),Fizz.restrict={},Fizz.restrict.toDataType=function(a,b,c){c="string"==typeof c?c:"this";var d=c+"."+a+"=(typeof value === '"+b+"')?value:"+c+"."+a+";";return new Function("value",d)},Fizz.restrict.toBoolean=function(a,b){return Fizz.restrict.toDataType(a,"boolean",b)},Fizz.restrict.toString=function(a,b){return arguments.length?Fizz.restrict.toDataType(a,"string",b):Object.prototype.toString.apply(this)},Fizz.restrict.toNumber=function(a,b){return Fizz.restrict.toDataType(a,"number",b)},Fizz.restrict.toInstanceType=function(a,b,c){c="string"==typeof c?c:"this";var d=c+"."+a+"=(value instanceof "+b+"||value === null)?value:"+c+"."+a+";";return new Function("value",d)},Fizz.restrict.toRange=function(a,b,c){if("undefined"==typeof b||!(b instanceof Array)||b.length<2)throw new Error("Attempt to restrict property to range with invalid range value");b=[Math.min.apply(this,b),Math.max.apply(this,b)],c="string"==typeof c?c:"this";var d="value=(typeof value === 'number')?value:0; "+c+"."+a+"=(value>="+b[0].toString()+")?((value <= "+b[1]+")?value:"+b[1]+"):"+b[0]+";";return new Function("value",d)}}(),this.Fizz=this.Fizz||{},function(){var a={};a.randomInt=function(a,b){return 0===arguments.length&&(a=0,b=1),1===arguments.length&&(b=a,a=0),Math.floor(Math.random()*(b+1-a))+Math.floor(a)},a.randomFloat=function(a,b){return 0===arguments.length&&(a=0,b=1),1===arguments.length&&(b=a,a=0),Math.random()*(b-a)+a},a.mapToDomain=function(a,b,c){if("number"==typeof a&&(a=[0,a]),!(a instanceof Array))throw new Error("Must provide a valid domain input!");if(a=[Math.min.apply(this,a),Math.max.apply(this,a)],b="undefined"==typeof b?[0,1]:b,"number"==typeof b&&(b=[0,b]),!(b instanceof Array))throw new Error("Must provide a valid range input!");if(b=[Math.min.apply(this,b),Math.max.apply(this,b)],a[0]===b[0]&&a[1]===b[1])return c;var d=a[1]-a[0],e=b[1]-b[0],f=parseFloat(d/e);return a[0]+(c-b[0])*f},a.wrapAround=function(a,b){if("number"==typeof a&&(a=[0,a]),!(a instanceof Array))throw new Error("Must provide a valid domain input!");if(a=[Math.min.apply(this,a),Math.max.apply(this,a)],b!==b)throw new Error("Must provide a valid value input!");for(var c=a[1]-a[0];b<=a[0];)b+=c;return b%c-1},Fizz.Math=a}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(a,b,c,d){switch(this._r=0,this._g=0,this._b=0,this._alpha=1,arguments.length){case 1:if(arguments[0]instanceof Array)this.init.apply(this,arguments[0]);else if("string"==typeof arguments[0]){for(var e=arguments[0].replace("#",""),f=0;f<e.length;f+=2){var g=["_r","_g","_b"][f/2];this[g]=parseInt(e.substring(f,f+2),16)}this._alpha=1}break;case 4:this.alpha=d;case 3:this.r=a,this.g=b,this.b=c}},add:function(a){if(a instanceof Fizz.Color)for(var b,c=0;3>c;c++)b=["r","g","b"][c],this[b]+=a[b];return this},subtract:function(a){if(a instanceof Fizz.Color)for(var b,c=0;3>c;c++)b=["r","g","b"][c],this[b]-=a[b];return this},equals:function(a,b){if(!(a instanceof Fizz.Color))return!1;"boolean"!=typeof b&&(b=!1);var c=this._r===a._r&&this._g===a._g&&this._b===a._b;return b?c&&this._alpha===a._alpha:c},copy:function(a){return a instanceof Fizz.Color&&this.init.call(this,a.toList(!0)),this},clone:function(){var b=new a;return b.copy(this),b},toRGB:function(a){var b=a?"rgba":"rgb";return b+"("+this.toList(a).toString()+")"},toHex:function(){var a=["_r","_g","_b"].map(function(a){return this[a].toString(16).toLowerCase()}.bind(this));return"#"+a.toString().replace(/,/g,"")},toList:function(a){return"boolean"!=typeof a&&(a=!1),[this._r,this._g,this._b].concat(a?this._alpha:[])},toString:function(){return"[Color ("+this.toList(!0)+")]"}});a.exposeProperty("BLACK",function(){return new a("#000000")}),a.exposeProperty("BLUE",function(){return new a("#0000FF")}),a.exposeProperty("CYAN",function(){return new a("#00FFFF")}),a.exposeProperty("GRAY",function(){return new a("#808080")}),a.exposeProperty("GREEN",function(){return new a("#008000")}),a.exposeProperty("MAGENTA",function(){return new a("#FF00FF")}),a.exposeProperty("RED",function(){return new a("#FF0000")}),a.exposeProperty("WHITE",function(){return new a("#FFFFFF")}),a.exposeProperty("YELLOW",function(){return new a("#FFFF00")}),a.exposeProperty("CLEAR",function(){return new a(0,0,0,0)});var b=[0,Math.pow(2,8)];a.prototype.exposeProperty("r","_r",Fizz.restrict.toRange("_r",b)),a.prototype.exposeProperty("g","_g",Fizz.restrict.toRange("_g",b)),a.prototype.exposeProperty("b","_b",Fizz.restrict.toRange("_b",b)),a.prototype.exposeProperty("alpha","_alpha",Fizz.restrict.toRange("_alpha",[0,1])),Fizz.Color=a}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(a){this._DOMElement=document.createElement("canvas"),this.element=a,this._windowPosition=new Fizz.Point(0,0),this._updateWindowPosition()},splice:function(a,b,c,d){if(arguments[0]&&arguments[0]instanceof Array)return this.splice.apply(this,arguments[0]);a="number"==typeof a?a:0,b="number"==typeof b?b:0,c="number"==typeof c?c:this.width,d="number"==typeof d?d:this.height;var e=document.createElement("canvas");e.width=c,e.height=d;var f=e.getContext("2d");return f.drawImage.apply(f,[this._DOMElement,a,b,c,d,0,0,c,d]),e},copy:function(a){if(!(a&&a instanceof HTMLCanvasElement))throw new Error("Argument 'canvas' must be a Fizz.Canvas instance!");this.width=a.width,this.height=a.height,this.element=a.splice()},clone:function(){var a=new Fizz.Canvas;return a.copy(this),a},toString:function(){return"[Canvas (width='"+this.width+"', height='"+this.height+"')]"},_updateWindowPosition:function(){var a=new Fizz.Point(0,0);if(this._DOMElement&&this._DOMElement.ownerDocument){var b=this._DOMElement.ownerDocument,c=this._DOMElement.getBoundingClientRect();a.x=c.left+window.pageXOffset-b.clientLeft,a.y=c.top+window.pageYOffset-b.clientTop}this._windowPosition=a.clone()}});a.prototype.exposeProperty("windowPosition"),a.prototype.exposeProperty("width","_DOMElement.width",Fizz.restrict.toNumber("_DOMElement.width")),a.prototype.exposeProperty("height","_DOMElement.height",Fizz.restrict.toNumber("_DOMElement.height")),a.prototype.exposeProperty("element","_DOMElement",Fizz.restrict.toInstanceType("_DOMElement","HTMLCanvasElement")),Fizz.Canvas=a}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(b,c,d){if(this._bubbles=!0,this._cancelable=!0,this._canceled=!1,this._immediatelyCanceled=!1,this._type=null,this._target=null,this._currentTarget=null,this._eventPhase=a.PHASE.NONE,this._timeStamp=Date.now(),null!==arguments[0]&&"object"==typeof arguments[0]){var e=arguments[0];this.assign(e)}else switch(arguments.length){case 3:this.cancelable=d;case 2:this.bubbles=c;case 1:this.type=b}},stopPropagation:function(){this._canceled=!0},stopImmediatePropagation:function(){this._immediatelyCanceled=!0,this.stopPropagation()},toString:function(){return"[Event (type='"+this._type+"', target='"+this._target+"')]"}});a.PHASE={},a.PHASE.NONE=0,a.PHASE.CAPTURING_PHASE=1,a.PHASE.AT_TARGET=2,a.PHASE.BUBBLING_PHASE=3,a.prototype.exposeProperty("bubbles","_bubbles",Fizz.restrict.toBoolean("_bubbles")),a.prototype.exposeProperty("cancelable","_cancelable",Fizz.restrict.toBoolean("_bubbles")),a.prototype.exposeProperty("canceled","_canceled",Fizz.restrict.toBoolean("_bubbles")),a.prototype.exposeProperty("immediatelyCanceled","_immediatelyCanceled",Fizz.restrict.toBoolean("_bubbles")),a.prototype.exposeProperty("type","_type",Fizz.restrict.toString("_type")),a.prototype.exposeProperty("eventPhase","_eventPhase",Fizz.restrict.toNumber("_eventPhase")),a.prototype.exposeProperty("timeStamp","_timeStamp",Fizz.restrict.toNumber("_timeStamp")),a.prototype.exposeProperty("target","_target",Fizz.restrict.toInstanceType("_target","Object")),a.prototype.exposeProperty("currentTarget","_currentTarget",Fizz.restrict.toInstanceType("_currentTarget","Object")),Fizz.Event=a}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(){this._parent=null,this._events={}},addEventListener:function(a,b,c){b.useCapture=!!c!=!1;var d=a.replace(/(\s)/,"").split(/[ ,]+/);if(d.length>1&&(a=d),a instanceof Array)a.forEach(function(a){this.addEventListener(a,b)});else{if(!(a in this._events))return void(this._events[a]=b);if("function"==typeof this._events[a]){if(this._events[a]===b)return;this._events[a]=[this._events[a]],this._events[a].push(b)}if(-1<this._events[a].indexOf(b))return;this._events[a].push(b)}},removeEventListener:function(a,b,c){c=!!c!=!1;var d=a.replace(/(\s)/,"").split(/[ ,]+/);if(d.length>1&&(a=d),a instanceof Array)for(var e=0;e<a.length;e++)this.removeEventListener(a[e],b);else{if(this._events[a]===b)return void delete this._events[a];var f=this._events[a].indexOf(b);f>-1&&(this._events[a].splice(f,1),1===this._events[a].length?this._events[a]=this._events[a][0]:0===this._events[a].length&&delete this._events[a])}},getEventListeners:function(a,b){b=!!b!=!1;var c=[],d=this._events[a];return"function"==typeof d&&d.useCapture===b?c.push(d):d instanceof Array&&(c=d.filter(function(a){return a.useCapture===b})),c},listensFor:function(a){return!!(a in this._events)},emit:function(a,b){var c;if(a instanceof Fizz.Event)c=a;else if("function"==typeof a)c=new a;else{if("string"!=typeof a)throw new Error("Call was made to 'emit' method with invalid value for argument 'eventObj'. Argument must be a string or Fizz.Event instance");c=new Fizz.Event({type:a})}c.target=this,c.assign(b);var d,e,f,g=this._buildCapturePath(),h=g.slice(0).reverse();for(c.eventPhase=Fizz.Event.PHASE.CAPTURING_PHASE,d=0;d<g.length;d++){if(c.canceled)return c.currentTarget;for(c.currentTarget=g[d],f=c.currentTarget.getEventListeners(c.type,!0),e=0;e<f.length;e++){if(c.canceled)return c.currentTarget;f[e].call(c.currentTarget,c)}}for(c.eventPhase=Fizz.Event.PHASE.BUBBLING_PHASE,d=0;d<h.length;d++){if(c.canceled)return c.currentTarget;for(c.currentTarget=h[d],f=c.currentTarget.getEventListeners(c.type,!1),e=0;e<f.length;e++){if(c.canceled)return c.currentTarget;f[e].call(c.currentTarget,c)}}},toString:function(){return"[EventEmitter]"},_buildCapturePath:function(){for(var a=this,b=[];a;)b.unshift(a),a=a.parent;return b}});a.initialize=function(b){if(a.prototype.forEach(function(a,c){-1===["constructor","init","toString"].indexOf(c)&&(b[c]=this[c])},a.prototype),b.hasOwnProperty("init")&&"function"==typeof b.init){var c=new Function("return "+b.init.toString())();for(var d in b.init)c[d]=b.init[d];b.init=function(){a.prototype.init.call(this),c.apply(this,arguments)}}else a.prototype.init.call(this)},a.prototype.on=a.prototype.addEventListener,a.prototype.off=a.prototype.removeEventListener,a.prototype.exposeProperty("parent","_parent",Fizz.restrict.toInstanceType("_parent","Fizz.EventEmitter")),Fizz.EventEmitter=a}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(a,b){this._x=0,this._y=0,this.x=a,this.y=b},add:function(a){return new Fizz.Point(this._x+a.x,this._y+a.y)},equals:function(a){return!(this._x!==a.x||this._y!==a.y)},distanceFrom:function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))},copy:function(a){this.init(a.x,a.y)},clone:function(){return new Fizz.Point(this._x,this._y)},toList:function(){return[this._x,this._y]},toString:function(){return"[Point (x='"+this._x+"',y='"+this._y+"')]"}});a.prototype.exposeProperty("x","_x",Fizz.restrict.toNumber("_x")),a.prototype.exposeProperty("y","_y",Fizz.restrict.toNumber("_y")),a.prototype.exposeProperty("length",function(){return this.distanceFrom(new Fizz.Point(0,0))}),Fizz.Point=a}(),this.Fizz=this.Fizz||{},function(){var a=Object.extend({init:function(a,b){this._position=new Fizz.Point(0,0),this._size=new Fizz.Point(0,0),a&&(a instanceof Fizz.Point?this.position=a.clone():2===a.length&&(this.position.x=a[0],this.position.y=a[1])),b&&(b instanceof Fizz.Point?this.size=b.clone():2===b.length&&(this.size.x=b[0],this.size.y=b[1]))},intersects:function(a){return a instanceof Array?a.reduce(function(a,b){return a&&this.intersects(b)}.bind(this),!0):(a instanceof Fizz.Point&&(a=new Fizz.Rectangle(a)),a instanceof Fizz.Rectangle?!(this.top>a.bottom||this.bottom<a.top||this.left>a.right||this.right<a.left):!1)},copy:function(a){return this.init(a.position.clone(),a.size.clone())},clone:function(){return new Fizz.Rectangle(this._position.clone(),this._size.clone())},toString:function(){return"[Rectangle (x='"+this._position.x+"', y='"+this._position.y+"', width='"+this._size.x+"', height='"+this._size.y+"')]"}});a.prototype.exposeProperty("position","_position",Fizz.restrict.toInstanceType("_position","Fizz.Point")),a.prototype.exposeProperty("size","_size",Fizz.restrict.toInstanceType("_size","Fizz.Point")),a.prototype.exposeProperty("x","_position.x",Fizz.restrict.toNumber("_position.x")),a.prototype.exposeProperty("y","_position.y",Fizz.restrict.toNumber("_position.y")),a.prototype.exposeProperty("width","_size.x",Fizz.restrict.toNumber("_size.x")),a.prototype.exposeProperty("height","_size.y",Fizz.restrict.toNumber("_size.y")),a.prototype.exposeProperty("left",function(){return this._position.x}),a.prototype.exposeProperty("top",function(){return this._position.y}),a.prototype.exposeProperty("right",function(){return this._position.x+this._size.x}),a.prototype.exposeProperty("bottom",function(){return this._position.y+this._size.y}),Fizz.Rectangle=a}(),this.Fizz=this.Fizz||{},function(){var a=function(){throw new Error("Error: UID object cannot be instantiated!")};a.get=function(){return a._nextID++},a._nextID=0,Fizz.UID=a}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.Rectangle.extend({init:function(a,b){Fizz.Rectangle.prototype.init.call(this,a,b),this._guid=Fizz.UID.get(),this._life=1/0,this._scale=new Fizz.Point(1,1),this._velocity=new Fizz.Point(0,0),this._acceleration=new Fizz.Point(0,0),this._density=0,this.name="Entity_"+this._guid,this.exists=!0},update:function(a){a="number"==typeof a?a:1,(this._life-=a)<1&&(this.exists=!1),this._velocity.x+=this._acceleration.x*a,this._velocity.y+=this._acceleration.y*a,this.x+=this._velocity.x*a,this.y+=this._velocity.y*a},kill:function(){return this.emit(Fizz.Entity.EVENTS.DEATH),this.exists=!1,this.parent=null,this},copy:function(a){return a instanceof Fizz.Entity||a instanceof Fizz.Rectangle?(this.position=a.position,this.size=a.size,a instanceof Fizz.Entity&&(this.name=a.name,this.exists=a.exists,this._scale=a.scale,this._velocity=a.velocity,this._acceleration=a.acceleration,this._density=a.density),this):!1},clone:function(){var a=new Fizz.Entity;return a.copy(this),a},toString:function(){return"[Entity (name='"+this.name+"')]"},_getGlobalPosition:function(){return Fizz.Stage&&this instanceof Fizz.Stage?new Fizz.Point(0,0):null===this.parent?new Fizz.Point(this.x,this.y):new Fizz.Point(this.x,this.y).add(this.parent._getGlobalPosition())}});Fizz.EventEmitter.initialize(a.prototype),a.EVENTS={},a.EVENTS.CLICK="click",a.EVENTS.DBLCLICK="dblclick",a.EVENTS.MOUSEMOVE="mouseMove",a.EVENTS.MOUSEDOWN="mousedown",a.EVENTS.MOUSEUP="mouseup",a.EVENTS.ADDED="added",a.EVENTS.REMOVED="removed",a.EVENTS.DEATH="death",a.prototype.exposeProperty("guid"),a.prototype.exposeProperty("parent","_parent",Fizz.restrict.toInstanceType("_parent","Fizz.Entity")),a.prototype.exposeProperty("life","_life",Fizz.restrict.toNumber("_life")),a.prototype.exposeProperty("scale","_scale",Fizz.restrict.toInstanceType("_scale","Fizz.Point")),a.prototype.exposeProperty("velocity","_velocity",Fizz.restrict.toInstanceType("_velocity","Fizz.Point")),a.prototype.exposeProperty("acceleration","_acceleration",Fizz.restrict.toInstanceType("_acceleration","Fizz.Point")),a.prototype.exposeProperty("density","_density",Fizz.restrict.toNumber("_density")),a.prototype.exposeProperty("globalPosition",function(){return this._getGlobalPosition()}),a.prototype.exposeProperty("stage",function(){return null===this.parent||Fizz.Stage&&this.parent instanceof Fizz.Stage?this.parent:this.parent.stage}),a.prototype.exposeProperty("onStage",function(){return null===this.stage?!1:this.intersects(this.stage)}),Fizz.Entity=a}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.Entity.extend({init:function(b,c){var d=[];"object"==typeof b&&null!==b&&(d=[b.position,b.size],delete b.position,delete b.size),Fizz.Entity.prototype.init.apply(this,d),this._caching=!1,this._snapToPixel=!1,this._cacheCanvas=null,this._cacheCanvasContext=null,this._alpha=1,this._fillStyle=a.BOUNDING_BOX_FILL_STYLE,this._strokeStyle=a.BOUNDING_BOX_STROKE_STYLE,this._lineWidth=a.BOUNDING_BOX_LINE_WIDTH,"object"==typeof b&&null!==b&&this.assign(b),"boolean"==typeof c&&c&&this.updateCache()},update:function(a){Fizz.Entity.prototype.update.call(this,a)},updateCache:function(){null===this._cacheCanvas&&(this._cacheCanvas=document.createElement("canvas"),this._cacheCanvasContext=this._cacheCanvas.getContext("2d")),(this.width!==this._cacheCanvas.width||this.height!==this._cacheCanvas.height)&&(this._cacheCanvas.width=Math.floor(this.width*Math.abs(this.scale.x))+1,this._cacheCanvas.height=Math.floor(this.height*Math.abs(this.scale.y))+1);var a=this._cacheCanvasContext,b=[.5,.5,this.width*Math.abs(this.scale.x),this.height*Math.abs(this.scale.y)];a.clearRect(0,0,this.width+1,this.height+1),a.globalAlpha=this._alpha,this._drawBoundingBox(a,b)},draw:function(a){if("undefined"==typeof a)return!1;if(!1===this.exists||!this._isVisible())return!1;var b=this._getGlobalPosition();this._snapToPixel&&(b.x=Math.floor(b.x)+.5,b.y=Math.floor(b.y)+.5),a.save(),a.imageSmoothingEnabled=a.mozImageSmoothingEnabled=a.webkitImageSmoothingEnable=!this._snapToPixel,(null===this._cacheCanvas||!1===this._caching)&&this.updateCache(),a.drawImage(this._cacheCanvas,b.x+.5,b.y+.5);var c=[this._position.x,this._position.y,this.width*Math.abs(this.scale.x),this.height*Math.abs(this.scale.y)];a.imageSmoothingEnabled=a.mozImageSmoothingEnabled=a.webkitImageSmoothingEnable=!1,a.beginPath(),a.rect.apply(a,c),a.closePath(),a.strokeStyle=this._strokeStyle.toRGB(!0),a.lineWidth=this._lineWidth,a.stroke(),a.restore()},copy:function(a){Fizz.Entity.prototype.copy.call(this,a),a instanceof Fizz.DisplayEntity&&(this.alpha=a.alpha,this.lineWidth=a.lineWidth,a.fillStyle!==Fizz.DisplayEntity.DEFAULT_FILL_STYLE&&(this.fillStyle=(new Fizz.Color).copy(a.fillStyle)),a.strokeStyle!==Fizz.DisplayEntity.DEFAULT_STROKE_STYLE&&(this.strokeStyle=(new Fizz.Color).copy(a.strokeStyle)))},clone:function(){var a=new Fizz.DisplayEntity;return a.copy(this),a},toString:function(){return"[DisplayEntity (name='"+this.name+"')]"},_isVisible:function(){return!(0===this.width*this.scale.x||0===this.height*this.scale.y||0===this._alpha||!1===this.exists)},_drawBoundingBox:function(a,b){a.beginPath(),a.rect.apply(a,b),a.closePath(),a.fillStyle=this._fillStyle.toRGB(!0),a.strokeStyle=this._strokeStyle.toRGB(!0),a.lineWidth=this._lineWidth,a.fill(),a.stroke()}});a.BOUNDING_BOX_FILL_STYLE=Fizz.Color.WHITE,a.BOUNDING_BOX_STROKE_STYLE=Fizz.Color.BLUE,a.BOUNDING_BOX_LINE_WIDTH=1,a.EVENTS={},a.prototype.exposeProperty("fillStyle","_fillStyle",Fizz.restrict.toInstanceType("_fillStyle","Fizz.Color")),a.prototype.exposeProperty("strokeStyle","_strokeStyle",Fizz.restrict.toInstanceType("_strokeStyle","Fizz.Color")),a.prototype.exposeProperty("lineWidth","_lineWidth",Fizz.restrict.toRange("_lineWidth",[0,999])),a.prototype.exposeProperty("caching","_caching",Fizz.restrict.toBoolean("_caching")),a.prototype.exposeProperty("snapToPixel","_snapToPixel",Fizz.restrict.toBoolean("_snapToPixel")),a.prototype.exposeProperty("scale","_scale",function(a){a instanceof Fizz.Point&&(this._scale=a,this.updateCache())}),a.prototype.exposeProperty("scaleX","_scale.x",function(a){"number"==typeof a&&(this._scale.x=a,this.updateCache())}),a.prototype.exposeProperty("scaleY","_scale.y",function(a){"number"==typeof a&&(this._scale.y=a,this.updateCache())}),a.prototype.exposeProperty("alpha","_alpha",function(a){var b=this._alpha;Fizz.restrict.toRange("_alpha",[0,1]).call(this,a),this._alpha!==b&&this.updateCache()}),a.prototype.exposeProperty("visible",function(){return this._isVisible()}),Fizz.DisplayEntity=a}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.DisplayEntity.extend({init:function(a,b){this._children=[],arguments[0]instanceof Fizz.DisplayEntity||arguments[0]instanceof Array?(Fizz.DisplayEntity.prototype.init.call(this,null,b),this.addChild(arguments[0])):Fizz.DisplayEntity.prototype.init.call(this,a,b)},update:function(a){Fizz.DisplayEntity.prototype.update.call(this,a),this._children.slice(0).forEach(function(b){b.update(a)})},updateCache:function(){this._width=this.width,this._height=this.height,Fizz.DisplayEntities.prototype.updateCache.call(this);var a=this._cacheCanvasContext;a.clearRect(0,0,a.canvas.width,a.canvas.height),this.children.forEach(function(b){b instanceof Fizz.DisplayEntity&&(b.updateCache(),b.draw(a))})},draw:function(a){!1===this._caching&&this.children.forEach(function(b){b.draw(a)}),Fizz.DisplayEntity.prototype.draw.call(this,a)},indexOf:function(a){return this._children.indexOf(a)},childAt:function(a){return 0>a||a>=this._children.length?null:this._children[a]},contains:function(a){return this.indexOf(a)>-1},getChildByName:function(a){if(0===this._children.length)return null;for(var b=0;b<this._children.length;b++)if(this._children[b].name===a)return this._children[b];return null},setIndexOfChild:function(a,b){if(-1===this.indexOf(a))return!1;var c=this._children.length;b=0>b?0:b,b=b>c-1?c:b,this.addChildAt(a,b)},addChild:function(){var a=Array.prototype.slice.call(arguments,0);return this.addChildAt.call(this,a)},addChildAt:function(a,b){return arguments.length>2&&(a=a.splice(0,a.length-1),b=a[a.length-1]),b="number"==typeof b?b:this._children.length,a instanceof Array?a.reduce(function(a,c,d){return a&&this.addChildAt(c,b+d)}.bind(this),!0):Fizz.Stage&&a instanceof Fizz.Stage?!1:a instanceof Fizz.Entity?(null!==a.parent&&a.parent.removeChild(a),a.parent=this,this._children.splice(b,0,a),a.emit(Fizz.Entity.EVENTS.ADDED,{}),!0):!1},removeChild:function(a){if(arguments.length>1&&(a=[a]),a instanceof Array)return a.reduce(function(a,b){return b}.bind(this),null);if(!(a instanceof Fizz.Entity))return null;var b=this.indexOf(a);return-1===b?null:(a.parent=null,this._children.splice(b,1),a.emit(Fizz.Entity.EVENTS.REMOVED,{}),a)},removeChildAt:function(a){if(0>a||a>=this._children.length)return null;var b=this._children[a];return b.parent=null,this._children.splice(a,1),b.emit(Fizz.Entity.EVENTS.REMOVED,{}),b},sort:function(a){this._children.sort(a)},empty:function(){if(0===this._children.length)return!0;var a=this._children.slice(0);return a.reduce(function(){return this.removeChild(this._children[0])}.bind(this),!0)},copy:function(a){if(Fizz.DisplayEntity.prototype.copy.call(this,a),a instanceof Fizz.DisplayGroup){this.empty();var b=this;a.children.forEach(function(a,b){this.addChild(a.clone(),b)}.bind(b))}},clone:function(){var a=new Fizz.DisplayGroup;return a.copy(this),a},toString:function(){return"[DisplayGroup (name='"+this.name+"', childCount='"+this.children.length+"')]"},_getChildrenBoundingBox:function(){if(0===this._children.length)return[new Fizz.Point(this._x,this._y),new Fizz.Point(this._x,this._y)];var a=null,b=null,c=null,d=null;return this._children.forEach(function(e){"number"!=typeof a&&(a=e.y),"number"!=typeof b&&(b=e.x),"number"!=typeof c&&(c=e.x+e.width),"number"!=typeof d&&(d=e.y+e.height),e.y<a&&(a=e.y),e.x<b&&(b=e.x),e.x+e.width>c&&(c=e.x+e.width),e.y+e.height>d&&(d=e.y+e.height)}),[new Fizz.Point(b,a),new Fizz.Point(c,d)]}});a.EVENTS={},a.prototype.add=a.prototype.addChild,a.prototype.remove=a.prototype.removeChild,a.prototype.exposeProperty("children"),a.prototype.exposeProperty("width",function(){var a=this._getChildrenBoundingBox(),b=a[0],c=a[1];return c.x-b.x}),a.prototype.exposeProperty("height",function(){var a=this._getChildrenBoundingBox(),b=a[0],c=a[1];return c.y-b.y}),Fizz.DisplayGroup=a}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.DisplayGroup.extend({init:function(b,c){if(0===arguments.length)b=window.document.createElement("canvas").getContext("2d"),b.canvas.width=a.DEFAULT_DIMENSIONS.x,b.canvas.height=a.DEFAULT_DIMENSIONS.y;else if(!(b instanceof CanvasRenderingContext2D))throw new Error("Attempt was made to instantiate a Stage instance without a valid drawing context");"number"==typeof c&&c>-1&&(this._frameRate=c)},render:function(){this._lastRenderTime=+new Date;var a=function(b){if(null!==this._canvas){if(this._logFrameRate&&0===(63&b)){var c=1e3/(b-this._lastRenderTime);console.log("Rendering at ",c.toString(),"FPS")}this.draw(),this._lastRenderTime=b;var d=function(){return a(+new Date)}.bind(this);this._requestAnimationFrame!==window.setTimeout?this._requestAnimationFrame.call(window,d,this._canvas):this._requestAnimationFrame.call(window,d,this._frameRate)}}.bind(this);a(this._lastRenderTime)},draw:function(){this._canvasContext.clearRect(0,0,this._canvas.width,this._canvas.height),this._canvasContext.save(),this.children.forEach(function(a){a instanceof Fizz.DisplayEntity&&a.draw(this._canvasContext)},this),this._canvasContext.restore()},toString:function(){return null===this._canvasContext.canvas?"[Stage (canvas='null')]":"[Stage (width='"+this._canvasContext.canvas.width+"', height='"+this._canvasContext.canvas.height+"')]"},_getRAFMethod:function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.setTimeout},_registerExternalListeners:function(){}});a.DEFAULT_DIMENSIONS=new Fizz.Point(600,400),a.DEFAULT_FRAME_RATE=1e3/60,a.EVENTS={},a.EVENTS.KEYDOWN="keyDown",a.prototype.exposeProperty("canvas","_canvasContext.canvas"),a.prototype.exposeProperty("width"),a.prototype.exposeProperty("height"),a.prototype.exposeProperty("frameRate","_frameRate",Fizz.restrict.toRange("_frameRate",[1,999])),a.prototype.exposeProperty("logFrameRate","_logFrameRate",Fizz.restrict.toBoolean("_logFrameRate")),a.prototype.banishProperty("parent"),a.prototype.banishProperty("exists"),a.prototype.banishProperty("life"),a.prototype.banishProperty("scale"),a.prototype.banishProperty("velocity"),a.prototype.banishProperty("acceleration"),a.prototype.banishProperty("density"),a.prototype.banishProperty("alpha"),Fizz.Stage=a}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.EventEmitter.extend({init:function(a){if(this._loaded=!1,this._source=null,this._sourceImage=null,this._sourceImageCache=null,this._sourceImageCacheContext=null,this._sourceWidth=0,this._sourceHeight=0,this._frames=[],this._framesCache=[],this._animations={},this.on(Fizz.Spritesheet.EVENTS.LOAD,this._onImageLoad,!1),this.on(Fizz.Spritesheet.EVENTS.ERROR,this._onImageError,!1),("string"==typeof a||a instanceof Image&&a.src)&&(a={source:a}),"object"==typeof a&&null!==a&&("source"in a&&(this.source=a.source),"frames"in a)){var b=a.frames;if(this.on(Fizz.Spritesheet.EVENTS.LOAD,function(){if("width"in b&&"height"in b){var a=0,c=0,d=b.width,e=b.height,f=b.count;f=f||this._sourceWidth/d*(this._sourceHeight/e);for(var g=0;f>g;g++)a>=this._sourceWidth&&(a=0,c+=e),this._frames[g]=[a,c,d,e],a+=d}else b instanceof Array&&(this._frames=b.filter(function(a){return 4===a.length}))},!1),"animations"in a){var c=a.animations;this.on(Fizz.Spritesheet.EVENTS.LOAD,function(){c.forEach(function(a,b){a instanceof Array&&a.length>=2&&(this._animations[b]={begin:a[0],end:a[1],speed:a[2]||1})},this)},!1)}}},getFrame:function(a){return"number"!=typeof a&&(a=0),a in this._frames?(a in this._framesCache||this._refreshFrameCache(a),this._framesCache[a]):null},getAnimation:function(a){return this._animations[a]||null},toString:function(){return"[Spritesheet (source='"+(this._source||"null")+"')]"},_onImageLoad:function(){this._loaded=!0,this._sourceWidth=this._sourceImage.width,this._sourceHeight=this._sourceImage.height,this._refreshImageCache(),0===this._frames.length&&this._frames.push([0,0,this._sourceWidth,this._sourceHeight])},_onImageError:function(){window.console.warn("Failed to load resource from'"+this._source+"'.")},_refreshImageCache:function(){null===this._sourceImageCache&&(this._sourceImageCache=document.createElement("canvas")),this._sourceImageCache.width=this._sourceWidth,this._sourceImageCache.height=this._sourceHeight,this._sourceImageCacheContext=this._sourceImageCache.getContext("2d"),this._sourceImageCacheContext.drawImage(this._sourceImage,0,0),this._framesCache={}},_refreshFrameCache:function(a){var b=this._frames[a];if(b){var c=new Fizz.Canvas(this._sourceImageCache);this._framesCache[a]=c.splice.apply(c,b)}}});Fizz.EventEmitter.initialize(a.prototype),a.EVENTS={},a.EVENTS.LOAD="load",a.EVENTS.ERROR="error",a.prototype.exposeProperty("sourceWidth"),a.prototype.exposeProperty("sourceHeight"),a.prototype.exposeProperty("loaded"),a.prototype.exposeProperty("source","_source",function(a){"string"==typeof a?(this._source=a,this._sourceImage=new Image,this._sourceImage.onload=this.emit.bind(this,"load"),this._sourceImage.onerror=this.emit.bind(this,"error"),this._sourceImage.src=this._source):a instanceof Image&&a.src&&(this._source=a.src,this._sourceImage=a,this._sourceImage.complete?setTimeout(this.emit.bind(this,Fizz.Spritesheet.EVENTS.LOAD),10):(this._sourceImage.onload=this.emit.bind(this,"load"),this._sourceImage.onerror=this.emit.bind(this,"error")))}),Fizz.Spritesheet=a}(),this.Fizz=this.Fizz||{},function(){var a=Fizz.DisplayEntity.extend({init:function(b){Fizz.DisplayEntity.prototype.init.call(this,null,!1),this._fillStyle=Fizz.Color.CLEAR,this._strokeStyle=Fizz.Color.CYAN,this._lineWidth=2,this._spritesheet=null,this._localFramesCache={},this._currentAnimation=a.DEFAULT_ANIMATION,this._currentFrame=this._currentAnimation.begin,this._paused=!0,b instanceof Fizz.Spritesheet&&(this._spritesheet=b,b=null),("string"==typeof b||b instanceof Image&&b.src)&&(this._spritesheet=new Fizz.Spritesheet({source:b}),b=null),this._spritesheet&&(this._spritesheet.loaded?this.updateCache():this._spritesheet.on("load",this.updateCache.bind(this))),"object"==typeof b&&null!==b&&("scale"in b&&b.scale instanceof Fizz.Point&&(this.scaleX=b.scale.x,this.scaleY=b.scale.y,delete b.scale),this.assign(b))},update:function(a){Fizz.DisplayEntity.prototype.update.call(this,a),!1===this._paused&&this._currentAnimation.begin<this._currentAnimation.end&&this._advanceFrame()
},updateCache:function(){if(null===this._spritesheet||!1===this._spritesheet.loaded)return void Fizz.DisplayEntity.prototype.updateCache.call(this);if(!(this._currentFrame in this._localFramesCache)){var b=this._localFramesCache[this._currentFrame]=this._spritesheet.getFrame(this._currentFrame);b.scale=a.NATIVE_SCALE.clone(),this._size=new Fizz.Point(b.width,b.height)}if(!1===this.scale.equals(this._localFramesCache[this._currentFrame].scale)){var c=this._spritesheet.getFrame(this._currentFrame),d=document.createElement("canvas");d.width=Math.abs(c.width*this._scale.x),d.height=Math.abs(c.height*this._scale.y),d.scale=this.scale.clone();var e=new Fizz.Point(this._scale.x<0?this.width:0,this._scale.y<0?this.height:0),f=d.getContext("2d");f.imageSmoothingEnabled=f.mozImageSmoothingEnabled=f.webkitImageSmoothingEnable=!1,f.save(),f.translate.apply(f,e.toList()),f.scale(this._scale.x,this._scale.y),f.drawImage(c,0,0),f.restore(),this._localFramesCache[this._currentFrame]=d}this._cacheCanvas=this._localFramesCache[this._currentFrame],this._cacheCanvasContext=this._cacheCanvas.getContext("2d")},play:function(){this._paused=!1},stop:function(){this._paused=!0},gotoAndPlay:function(a){this._goto(a),this.updateCache(),this.play()},gotoAndStop:function(a){this._goto(a),this.updateCache(),this.stop()},copy:function(a){Fizz.DisplayEntity.prototype.copy.call(this,a),a instanceof Fizz.Sprite&&(this._spritesheet=a.spritesheet,this._paused=a._paused,this._currentAnimation=a._currentAnimation,this._currentFrame=a._currentFrame)},clone:function(){var a=new Fizz.Sprite;return a.copy(this),a},toString:function(){return"[Sprite (name='"+this.name+"')]"},_goto:function(b){"string"==typeof b?this._currentAnimation=this._spritesheet.getAnimation(b):(this._currentAnimation=a.DEFAULT_ANIMATION,this._currentFrame=b)},_advanceFrame:function(){var a=this._currentAnimation;this._currentFrame===a.end&&a.next?(this._currentAnimation=this._spritesheet.getAnimation(a.next),this._currentFrame=this._currentAnimation.begin):this._currentFrame===a.end?this._currentFrame=a.begin:this._currentFrame+=1}});a.NATIVE_SCALE=new Fizz.Point(1,1),a.DEFAULT_ANIMATION={begin:0,end:0,next:null},a.prototype.exposeProperty("paused"),a.prototype.exposeProperty("spritesheet","_spritesheet",Fizz.restrict.toInstanceType("_spritesheet","Fizz.Spritesheet")),Fizz.Sprite=a}();
//# sourceMappingURL=fizz.min.js.map